<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fantasy LEC</title>
    <link type="text/css"
          rel="stylesheet"
          href="LEC_stiler.css">
    <link rel="icon" href="bilder/leclogotransparent.png">
  <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCD3UFf10gPrGUW6w3gt-z9kt8Iq_4rOPw",
      authDomain: "fantasy-lec.firebaseapp.com",
      databaseURL: "https://fantasy-lec.firebaseio.com",
      projectId: "fantasy-lec",
      storageBucket: "",
      messagingSenderId: "34381750647"
    };
    firebase.initializeApp(config);
  </script>
</head>
<body>
<div id="login">
  <!-- Dette elementet skal være det eneste man ser før man logger inn. Her logger man inn, eller oppretter en bruker. Etter å ha logget inn, forsvinner dette elementet, og hovednettsiden vises -->
  <img src="bilder/leclogo-mono.jpg">
  <form id="loginForm" onsubmit="LogIn(event)">
    <h1>Logg in</h1>
    <input type="text" required id="LogInBrukernavn" placeholder="Brukernavn">
    <input type="password" required id="LogInPassord" placeholder="Passord">
    <button type="submit">Logg inn</button>
  </form>
  <form id="registrerForm" onsubmit="registrerBruker(event)">
    <h1>Registrer bruker</h1>
    <input type="text" required id="registrerBrukernavn" placeholder="Brukernavn">
    <input type="password" required id="registrerPassord" placeholder="Passord">
    <button type="submit">Opprett bruker</button>
  </form>
</div>
<header>
</header>
<main>
  <br>
  <br>
  <br>
  <section id="tittel">
    <img src="bilder/leclogotransparent.png">
    <h1 id="title">LEC</h1>
  </section>
  <section id="lag">

  </section>
  <!-- Denne seksjonen kan bare brukeren som er admin se -->
  <section id="admin">
    <h2>Sett opp en kamp:</h2>
    <form id="matchregistration" onsubmit="registrerMatch(event)">
      <label>Lag 1:<select id="adminInpLag1">
        <option value="TBD">TBD</option>
      </select></label>
      <label>Lag 2:<select id="adminInpLag2">
        <option value="TBD">TBD</option>
      </select></label>
      <label>Runde:<select id="rundeInp">
        <option value="1">Runde 1</option>
        <option value="2">Runde 2</option>
        <option value="3">Runde 3</option>
        <option value="4">Finale</option>
      </select></label>
      <label>Kamp nummer:<select id="kampNrInp">
        <option value="1">1</option>
        <option value="2">2</option>
      </select></label>
      <button type="submit">Send inn</button>
    </form>
  </section>
  <section id="kampListe">

  </section>
  <section id="leaderboard">
    <table>
      <thead>
        <th>Poeng</th>
        <th>Bruker</th>
      </thead>
      <tbody>

      </tbody>
    </table>
  </section>
  <section id="historie">

  </section>
</main>
<footer>
  <p>Laget og administrert av Marius Berdal Gaalaas</p>
</footer>
<script>
  let database = firebase.database();
  let brukere = database.ref("brukere");
  let bruker;
  let lag = database.ref("lag");
  let kamper = database.ref("kamper");

  // Funksjoner
  //Registrer en bruker og legger det til i en database
  function registrerBruker(event){
    event.preventDefault();
    let brukernavnRegistrer = document.querySelector("#registrerBrukernavn");
    let passordRegistrer = document.querySelector("#registrerPassord");
    let registrerSkjema = document.querySelector("#registrerForm");
    brukere.push({
      "brukernavn":brukernavnRegistrer.value,
      "passord":passordRegistrer.value,
      "admin":false,
      "poeng":0
    });
    registrerSkjema.reset();
  }
  //De to neste funksjonene logger deg inn, og ordner slik at login siden forsvinner og resten kommer til syne
  function LogIn(event){
    event.preventDefault();
    brukere.on("child_added", hentBrukereLogIn);
  }
  function hentBrukereLogIn(snapshotLogIn){
    let brukernavn = document.querySelector("#LogInBrukernavn");
    let passord = document.querySelector("#LogInPassord");
    bruker = snapshotLogIn.val();
    if (brukernavn.value ==bruker.brukernavn && passord.value==bruker.passord){
      let loginscreen = document.querySelector("#login");
      let header = document.querySelector("header");
      let main = document.querySelector("main");
      let footer = document.querySelector("footer");

      loginscreen.style.display = "none";
      header.style.display = "block";
      main.style.display = "grid";
      footer.style.display = "block";

      if (bruker.admin){
        let admindel = document.querySelector("#admin");
        admindel.style.display = "block";
      }

      header.innerHTML += `
      <p>${brukernavn.value}</p><p>${-bruker.poeng} poeng</p><button onclick="location.reload()">Logg ut</button>
      `;
    }
  }
  function hentLag(snapshotLag){
    let lagdel = document.querySelector("#lag");
    let lagKey = snapshotLag.key;
    let lag = snapshotLag.val();
    lagdel.innerHTML += `
    <a href=${lag.link}><img src=${lag.logo} title=${lag.navn}></a>
    `;
    let adminLag1 = document.querySelector("#adminInpLag1");
    let adminLag2 = document.querySelector("#adminInpLag2");
    adminLag1.innerHTML +=`
    <option value="${lagKey}">${lag.navn}</option>
    `;
    adminLag2.innerHTML +=`
    <option value="${lagKey}">${lag.navn}</option>
    `;
  }
  function registrerMatch(event){
    event.preventDefault();
    let regiLag1 = document.querySelector("#adminInpLag1");
    let regiLag2 = document.querySelector("#adminInpLag2");
    let regiRunde = document.querySelector("#rundeInp");
    let regiKampNr = document.querySelector("#kampNrInp");
    kamper.push({
      "lag1": regiLag1.value,
      "lag2": regiLag2.value,
      "runde": regiRunde.value,
      "kampnummer": regiKampNr.value,
      "lag1resultat": "TBD",
      "lag2resultat": "TBD",
      "vinner": "TBD"
    });
  }
  function Leaderboard(snapshotBrukere){
    let brukerL = snapshotBrukere.val();
    let tabell = document.querySelector("tbody");
    tabell.innerHTML += `
    <tr>
      <td>${-brukerL.poeng}</td>
      <td>${brukerL.brukernavn}</td>
    </tr>
    `;
  }
  function hentkamper(snapshotKamper){
    let kampListe = document.querySelector("#kampListe");
    let kamp = snapshotKamper.val();
    let kampID = kamp.runde.value + "-" + kamp.kampnummer.value;
    let kampID1 = kamp.runde.value + "-" + kamp.kampnummer.value + "L1";
    let kampID2 = kamp.runde.value + "-" + kamp.kampnummer.value + "L2";
    let lagref1 = database.ref("lag/"+kamp.lag1);
    let lagref2 = database.ref("lag/"+kamp.lag2);
    kampListe.innerHTML +=`
    <div class="kamp"><div id=${kampID1}></div><div id=${kampID2}></div><form id=${kampID}></form></div>
    `;
    lagref1.once("value", function (snapshotLag1){
      let lag1 = snapshotLag1.val();
      let lag1display = document.querySelector("#" + kampID1);
      lag1display.innerHTML += `
      <img src=${lag1.logo}>
      <p>${lag1.navn}</p>
      `;
    });
    lagref2.once("value", function (snapshotLag2){
      let lag2 = snapshotLag2.val();
      let lag2display = document.querySelector("#" + kampID2);
      lag2display.innerHTML += `
      <img src=${lag2.logo}>
      <p>${lag2.navn}</p>
      `;
    });
  }
  brukere
    .orderByChild("poeng")
    .on("child_added", Leaderboard);
  lag.on("child_added", hentLag);
  kamper.on("child_added", hentkamper);
</script>
</body>
</html>
